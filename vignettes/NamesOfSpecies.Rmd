---
title: "Names of New Species"
author: "Alexandra Sarafoglou"
date: "7/21/2022"
output: html_document
vignette: >
  %\VignetteIndexEntry{Names of New Species}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
bibliography: ../inst/REFERENCES.bib
---

In this vignette, we will explain how to compute a Bayes factor for informed hypotheses on binomial probabilities.

## Model and Data

As an example on how to compute Bayes factors to test the ordinal relations for ordered binomial probabilities we will use data from @poulin2022species. Specifically, we will test whether there is an increasing trend from 2000 - 2022 to name newly discovered species after family members, friends or pets.


```{r load_data}
# load the package and data
library(multibridge)
dat0 <- as.data.frame(readxl::read_xlsx('~/Downloads/doi_10/Etymology_dataset_FINAL.xlsx'))
# 140 species were named after family members, pets, or friends of the authors
# data available at: https://doi.org/10.6084/m9.figshare.19634513.v1
dat <- data.frame(year=2000:2020,
                  x=c(0, 7, 2, 3, 4, 6, 10, 4, 8, 10, 9, 11, 6, 8, 8, 5, 6, 15, 7, 4, 7),
                  n = c(89, 101, 85, 96, 102, 112, 156, 178, 149, 151, 143, 167, 155, 159, 157, 136,
                        112, 150, 174, 146, 173) )
dat$prop <- dat$x/dat$n
```

The model that we will use assumes that the elements in the vector of successes $x_1, \cdots, x_K$ and the elements in the vector of total number of observations $n_1, \cdots, n_K$ in the $K$ categories follow independent binomial distributions. The parameter vector of the binomial success probabilities, $\theta_1, \cdots, \theta_K$, contains the probabilities of observing a value in a particular category; here, it reflects the probabilities of naming a new species after a familiy member, friend, or pet. The parameter vector $\theta_1, \cdots, \theta_K$ are drawn from independent beta distributions with parameters $\alpha_1, \cdots, \alpha_K$ and $\beta_1, \cdots, \beta_K$. The model can be described as follows:

\begin{align}
  x_1 \cdots x_K & \sim \prod_{k = 1}^K \text{Binomial}(\theta_k, n_k) \\
  \theta_1 \cdots \theta_K &\sim \prod_{k = 1}^K \text{Beta}(\alpha_k, \beta_k) \\
\end{align}

Here, we test the inequality-constrained hypotheses $\mathcal{H}_{r}$ formulated by @poulin2022species, that the proportion of species named after family members, friends, or pets are increasing over the years. We will test this hypothesis against the encompassing hypothesis $\mathcal{H}_e$ without any constraints and the null hypothesis will states that all proportions are exactly equal. 

\begin{align*}
    \mathcal{H}_e &: (\theta_{\text{2000}}, \theta_{\text{2001}}, \cdots , \theta_{\text{2019}}, \theta_{\text{2020}}, 
    \mathcal{H}_0 &: (\theta_{\text{2000}} = \theta_{\text{2001}} = \cdots = \theta_{\text{2019}} = \theta_{\text{2020}}, 
    \mathcal{H}_{r} &: \theta_{\text{200}} < \theta_{\text{2001}} < \cdots} < \theta_{\text{2019}} < \theta_{\text{2020}}.
\end{align*}

To evaluate the inequality-constrained hypothesis, we need to specify (1) a vector with observed successes, and (2) a vector containing the total number of observations, (3) the informed hypothesis, (4) a vector with prior parameters alpha for each binomial proportion, (5) a vector with prior parameters beta for each binomial proportion, and (6) the labels of the categories of interest (i.e., gender and education level): 

```{r specify_hr}
# number of violations
x <- dat$x
# total number people in the category
n <- dat$n

# Specifying the informed Hypothesis (step 3)
Hr <- paste(dat$year, collapse = ' < ')
# "2000 < 2001 < 2002 < 2003 < 2004 < 2005 < 2006 < 2007 < 
# 2008 < 2009 < 2010 < 2011 < 2012 < 2013 < 2014 < 2015 < 
# 2016 < 2017 < 2018 < 2019 < 2020"

# Prior specification (step 4 and 5)
# We assign a uniform beta distribution to each binomial propotion
a <- rep(1, 21)
b <- rep(1, 21)

# categories of interest (step 6)
years <- dat$year
```

## Analysis of BFre

With this information, we can now conduct the analysis with the function `binom_bf_informed()`. Since we are interested in quantifying evidence in favor of the restricted hypothesis, we set the Bayes factor type to `BFre`. For reproducibility, we are also setting a seed with the argument `seed`:

```{r compute_results}
m0 <- binom_bf_equality(x=x, n=n, a=a, b=b)
  
ineq_results <- multibridge::binom_bf_informed(x=x, n=n, Hr=Hr, a=a, b=b, 
                                             factor_levels=years, 
                                             bf_type = 'BFre',
                                             seed = 2020)
mr <- summary(ineq_results)
```

We can inspect the percentage error from all three models from the output object. From that, we can see that the overall relative mean-square error for all three models is quite low, which suggests stable results. 

```{r percentage_error}
ineq_results$bf_list$error_measures
```

For hypotheses $\mathcal{H}_{r}$, the data are `r round(1/(mr$bf))` more likely under the encompassing hypothesis than under the 
informed hypothesis. This hypothesis predicted that the proportion of new species named after family members, pets, or friends of scientists are increasing over the years. In contrast, we collected extreme evidence in favor for the null hypothesis $\mathcal{H}_{0}$ compared to the encompassing hypothesis, with a Bayes factor of `r papaja::print_num(m0$bf$BF0e, format = 'e')` in favor for the null. When comparing $\mathcal{H}_{0}$ and $\mathcal{H}_{r}$ directly with each other, we find that the data are `r papaja::print_num(1/(mr$bf * m0$bf$BFe0), format='e')` times more likely under the null than under the informed hypothesis.

We can see that the proportion remains stable over the years by plotting the posterior estimates:

```{r plot_estimates}
plot(mr)
```


With regard to hypothesis $\mathcal{H}_{r}$, we can conclude that our analysis contradicts the conclusions drawn by @poulin2022species, that there is an increasing trend to name new species after family members, friends, or pets from researchers who discovered them. Instead, the proportion of such personal names has remained stable over the years, at just 5\% of all names of newly discovered species.
   
# References